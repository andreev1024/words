(()=>{"use strict";function e(){const e=t();if(0===e.length)throw new Error("No stored words");return e}function t(){const e=localStorage.getItem("words");return null===e?[]:JSON.parse(e)}function r(e){const t=JSON.stringify(i(e).unique().toArray());localStorage.setItem("words",t)}function n(t){return i(e()).get(t)}const s=/^[\u0400-\u04FF]+$/,o=(e,t)=>({en:e,ru:t}),i=e=>({items:e,unique(){const e={};return this.items.forEach((t=>{e[t.en]=t})),i(Object.values(e))},toArray(){return this.items},get(e){const t=this.find(e);if(t)return t;throw new Error("Word does not exist")},find(e){return this.items.find((t=>t.en===e))}});function a(e){throw new Error(e)}function c(t,r){let n,s=e(),o=s[0];if(1===s.length)return o;if(void 0!==r&&(n=s.findIndex((e=>e.en===r)),-1===n))throw new Error("previous word index undefined");if(void 0!==n){s.splice(n,1);const e=Math.min(...s.map((e=>t.get(e.en)?.shows??0))),r=[];s.forEach((n=>{(t.get(n.en)?.shows??0)-e<1&&r.push(n)})),s=r}return o=s[Math.floor(Math.random()*s.length)],o}function l(e){return[[/['’`]m/gi," am"],[/['’`]s/gi," is"],[/['’`]re/gi," are"]].forEach((([t,r])=>{e=e.replace(t,r)})),[[/['’`]ll/gi," will"]].forEach((([t,r])=>{e=e.replace(t,r)})),e=(e=e.replace(/\s+/g," ")).trim().toLowerCase()}const d=e=>{const t=document.getElementById(e);if(null===t)throw new Error;return t},u=e=>d(e),w=e=>{e.classList.add("hidden")},h=e=>{e.classList.remove("hidden")},p=()=>({shows:0,inc(){this.shows++}}),f={items:{},add(e){void 0===this.items[e]&&(this.items[e]=p()),this.items[e].inc(e)},get(e){return this.items[e]},reset(){this.items={}},updateKey(e,t){if(e===t)return;const r=this.get(e);r&&(this.items[t]=r,delete this.items[e])}};class m{#e;constructor(){this.#e=d("edit-word-wrapper"),this.#e.onclick=this.#t.bind(this)}static show(e){const t=m.#r();t.dataset.prev=e.ru,t.value=e.ru;const r=m.#n();r.dataset.prev=e.en,r.value=e.en,h(u("edit-word-wrapper"))}#t(e){const t=e.target?.dataset?.action;"save"===t&&this.#s()}#s(){const t=m.#r(),n=m.#n(),s=n.dataset.prev,i=t.dataset.prev,a=o(n.value,t.value);if(void 0===s||void 0===i)throw new Error;s===n.value&&i===t.value||(function(t,n){const s=[];e().forEach((e=>s.push(e.en===t?n:e))),r(s)}(s,a),f.updateKey(s,n.value)),v.show(a),m.#o()}static#o(){w(u("edit-word-wrapper"))}static#r(){return u("edit-word-translation")}static#n(){return u("edit-word-title")}}class v{#e;constructor(){this.#e=d("learn-word-wrapper"),this.#e.onclick=this.#t.bind(this),this.#e.onkeydown=this.#i.bind(this)}static show(e){w(d("new-words-wrapper")),u("word").value=e.ru,u("correct-answer").value=e.en;const t=u("user-answer");t.value="",h(d("learn-word-wrapper")),t.focus()}static isActive(){return!(null===d("learn-word-wrapper").offsetParent)}static showAnswer(){const e=n(u("correct-answer").value),t=u("word");t.value=t.value===e.ru?e.en:e.ru}static skipWord(){const t=u("correct-answer").value,n=c(f,t),s=e(),o=s.findIndex((e=>e.en===t));if(-1===o)throw new Error("word doesn't exist");s.splice(o,1),r(s),0===s.length?v.#a():v.show(n)}static#a(){u("new-words").value="",h(d("new-words-wrapper")),w(d("learn-word-wrapper"))}static#c(){localStorage.removeItem("words"),v.#a()}static#l(){v.#o(),m.show(n(u("correct-answer").value))}static#d(){const e=u("user-answer"),t=e.value,r=u("correct-answer").value;if(n=r,l(t)!==l(n))return e.classList.add("red"),void setTimeout((()=>d("user-answer").classList.remove("red")),1e3);var n;f.add(r);const s=c(f,r);v.show(s)}#t(e){const t={edit:v.#l,"show-answer":v.showAnswer,"add-new-words":v.#a,skip:v.skipWord,"reset-storage":v.#c,check:v.#d};let r;for(const n in t)if(e.target.closest(`[data-action="${n}"]`)){r=n;break}if(!r)return;const n=t[r];n&&n()}#i(e){e.target instanceof HTMLInputElement&&"user-answer"===e.target.id&&"Enter"===e.code&&v.#d()}static#o(){w(u("learn-word-wrapper"))}}console.log("AAa"),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&v.isActive()){if("KeyA"===e.code)return v.showAnswer(),void e.preventDefault();if("KeyS"===e.code)return void v.skipWord()}})),(()=>{const e=u("new-words");e.placeholder=e.placeholder.replace(/\\n/g,"\n")})(),function(){const e=localStorage.getItem("words");return null!==e&&JSON.parse(e).length>0}()&&v.show(c(f)),new class{#e;constructor(){this.#e=d("new-words-wrapper"),this.#e.onclick=this.#t.bind(this)}#u(){const e=function(e){const t=[];return""===e.trim()||(e.split("\n").forEach((function(e){const r=e.trim();if(""===r)return;let n=null,i=null;[...r].forEach((function(e,t){if(i)return;if(" "===e)return;const r=s.test(e)?"ru":"en";if(null!==n)return n!==r?(null!==i&&a("Invalid input"),void(i=t)):void 0;n=r})),"number"!=typeof i&&a("Invalid input");const c=r.substring(0,i).trim(),l=r.substring(i).trim();t.push(o(s.test(c[0])?l:c,s.test(c[0])?c:l))})),0===t.length&&a("Invalid input")),t}(d("new-words").value);var n;0!==e.length&&(f.reset(),n=e,r(t().concat(n)),v.show(c(f)))}#t(e){const t=e.target?.dataset?.action;"learn"===t&&this.#u()}},new v,new m})();
//# sourceMappingURL=index.js.map